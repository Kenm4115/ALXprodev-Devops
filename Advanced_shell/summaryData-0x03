#!/bin/bash

# Output CSV file
REPORT_FILE="pokemon_report.csv"

# Create CSV header
echo "Name,Height(m),Weight(kg)" > "$REPORT_FILE"

# Loop through all JSON files in the current directory
for file in *.json; do
    if [[ -f "$file" ]]; then
        # Extract values using jq
        name=$(jq -r '.name' "$file" | sed 's/.*/\u&/')
        height=$(jq -r '.height' "$file")   # decimeters
        weight=$(jq -r '.weight' "$file")   # hectograms

        # Convert to meters and kg
        height_m=$(awk "BEGIN {printf \"%.1f\", $height/10}")
        weight_kg=$(awk "BEGIN {printf \"%.1f\", $weight/10}")

        # Append to CSV
        echo "$name,$height_m,$weight_kg" >> "$REPORT_FILE"
    fi
done

# Calculate averages using awk (skip header)
echo "" >> "$REPORT_FILE"
awk -F',' 'NR>1 && NF==3 {total_h+=$2; total_w+=$3; count++}
    END {
        if (count > 0) {
            avg_h = total_h / count;
            avg_w = total_w / count;
            printf "Average,%.2f,%.2f\n", avg_h, avg_w
        }
    }' "$REPORT_FILE" >> "$REPORT_FILE"

echo "âœ… Report generated: $REPORT_FILE"
